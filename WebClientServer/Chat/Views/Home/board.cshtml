@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Board";
}

<h2>Board</h2>
<style>
    #canvasImage {
        width: 300px;
        height: 300px;
        margin: 0 auto;
        z-index: 10;
    }

    #tmp_canvas {
        width: 300px;
        height: 300px;
        position: absolute;
        left: 8px;
        cursor: crosshair;
        margin: 0 auto;
        z-index: 20;
    }
</style>
<div id="boardElementContainer">
    <canvas id="canvasImage"></canvas>
</div>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/jquery.signalR-2.0.2.js"></script>
    <script src="~/Scripts/board.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        var sketch = document.getElementById('boardElementContainer');
        var canvas = document.getElementById('canvasImage');
        var context = canvas.getContext('2d');
        var myBoard = null;

        $(function () {
            var board = $.connection.boardHub;
            board.client.Signal = function (data) {
                if (myBoard) {
                    switch (data.MessageDetail.tool) {
                        case 'pencil':
                            myBoard.drawStroke(data.MessageDetail.Stroke, data.MessageDetail.color);
                            break;
                        case 'eraser':
                            myBoard.eraseStroke(data.MessageDetail.Stroke);
                            break;
                        default:
                            myBoard.drawStroke(data.MessageDetail.Stroke, data.MessageDetail.color);
                            break;
                    }
                };
            };
            $.connection.hub.start().done(function () {
                myBoard = new Board();
                myBoard.init(sketch, canvas, 'pencil', 'red', '5', function (stroke) {
                    board.server.signal({ type: 'test', messagedetail: { stroke: stroke, tool: 'pencil', color: 'red' } });
                    //data: {
                    //    type: "stroke",
                    //    //message: { stroke: stroke, tool: 'pencil', color: 'red', }
                    //}
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}


